<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>R Templates Library</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; max-width: 1050px; }
    .muted { color: #666; font-size: 13px; margin-bottom: 12px; }
    input { width: 100%; padding: 10px; font-size: 14px; }
    .card { border: 1px solid #ddd; padding: 12px; margin-top: 12px; border-radius: 8px; }
    pre { background: #f5f5f5; padding: 12px; overflow: auto; white-space: pre; }
    button { padding: 8px 12px; cursor: pointer; }
    .tag { display:inline-block; padding: 2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; margin-right:6px; background:#fafafa; }
    h3 { margin: 0 0 8px 0; }
  </style>
</head>
<body>
  <h1>R Templates Library</h1>
  <div class="muted">
    This is a static template reference. Use the search box to filter by template name/tags and copy code.
    Replace placeholders (DATA, TIME, OUTCOME, etc.) in RStudio.
  </div>

  <input id="q" placeholder="Search templates (e.g., cox, km, roc, sensitivity, wilcox, lm, glm, chi-square)..." />

  <div id="results"></div>

  <script>
    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function copyText(text) {
      // prompt() works on locked school browsers where clipboard API is blocked
      window.prompt("Copy the code below:", text);
    }

    // ---- Put ALL your lab templates here (name + tags + code) ----
    // Add more by copying one object and pasting another under it.
    var templates = [

      {
        id: "load_excel_count_rows",
        name: "Load Excel (.xlsx) + count rows",
        tags: ["readxl", "import", "nrow"],
        code: [
          "# Step 1",
          "",
          "library(readxl)",
          "DATA <- as.data.frame(read_excel(\"FILE.xlsx\"))",
          "nrow(DATA)"
        ].join("\n")
      },

      {
        id: "chisq_fisher",
        name: "Chi-square test / Fisher test",
        tags: ["table", "chisq.test", "fisher.test"],
        code: [
          "# Step 1",
          "",
          "tb <- with(DATA, table(VARIABLE1, VARIABLE2))",
          "tb",
          "",
          "chisq.test(tb)",
          "",
          "# If chi-square is not appropriate (small counts):",
          "fisher.test(tb)",
          "",
          "# If fisher is large-table and complains:",
          "fisher.test(tb, sim = TRUE)"
        ].join("\n")
      },

      {
        id: "wilcoxon_2group",
        name: "Wilcoxon / Mann–Whitney test (2 groups)",
        tags: ["wilcox.test", "nonparametric"],
        code: [
          "# Step 1",
          "",
          "wilcox.test(VARIABLE ~ GROUP, data=DATA)",
          "",
          "# Alternative syntax",
          "",
          "with(DATA, wilcox.test(VARIABLE[GROUP==0], VARIABLE[GROUP==1]))"
        ].join("\n")
      },

      {
        id: "glm_binomial_getci",
        name: "Logistic regression (binomial) + OR via getCI()",
        tags: ["glm", "binomial", "odds ratio"],
        code: [
          "# Step 1",
          "",
          "m1 <- glm(OUTCOME ~ EXPOSURES, data=DATA, family=\"binomial\")",
          "summary(m1)",
          "",
          "# Step 2",
          "",
          "source(\"getCI.R\")",
          "round(exp(getCI(m1)), 2)"
        ].join("\n")
      },

      {
        id: "km_group_logrank",
        name: "Kaplan–Meier by group + log-rank",
        tags: ["survival", "survfit", "survdiff"],
        code: [
          "# Step 1",
          "",
          "library(survival)",
          "s1 <- survfit(Surv(TIME, EVENT) ~ GROUP, data=DATA)",
          "summary(s1)",
          "",
          "# Step 2",
          "",
          "plot(s1)",
          "",
          "# Step 3",
          "",
          "survdiff(Surv(TIME, EVENT) ~ GROUP, data=DATA)"
        ].join("\n")
      },

      {
        id: "coxph_getci",
        name: "Cox regression + HR via getCI()",
        tags: ["survival", "coxph", "hazard ratio"],
        code: [
          "# Step 1",
          "",
          "library(survival)",
          "m1 <- coxph(Surv(TIME, EVENT) ~ EXPOSURES, data=DATA)",
          "summary(m1)",
          "",
          "# Step 2",
          "",
          "source(\"getCI.R\")",
          "round(exp(getCI(m1)), 2)"
        ].join("\n")
      },

      {
        id: "sens_spec",
        name: "Sensitivity & specificity (2x2 diagnostic test)",
        tags: ["sensitivity", "specificity", "diagnostics"],
        code: [
          "# Step 1",
          "",
          "# Sensitivity: P(TEST=1 | DISEASE=1)",
          "with(DATA, sum(TEST==1 & DISEASE==1) / sum(DISEASE==1))",
          "",
          "# Specificity: P(TEST=0 | DISEASE=0)",
          "with(DATA, sum(TEST==0 & DISEASE==0) / sum(DISEASE==0))"
        ].join("\n")
      },

      {
        id: "ppv_npv_lr",
        name: "PPV, NPV, LR(+), LR(-)",
        tags: ["ppv", "npv", "likelihood ratio"],
        code: [
          "# Step 1",
          "",
          "# PPV: P(DISEASE=1 | TEST=1)",
          "with(DATA, sum(TEST==1 & DISEASE==1) / sum(TEST==1))",
          "",
          "# NPV: P(DISEASE=0 | TEST=0)",
          "with(DATA, sum(TEST==0 & DISEASE==0) / sum(TEST==0))",
          "",
          "# LR(+): sensitivity / (1 - specificity)",
          "with(DATA, (sum(TEST==1 & DISEASE==1)/sum(DISEASE==1)) / (sum(TEST==1 & DISEASE==0)/sum(DISEASE==0)))",
          "",
          "# LR(-): (1 - sensitivity) / specificity",
          "with(DATA, (sum(TEST==0 & DISEASE==1)/sum(DISEASE==1)) / (sum(TEST==0 & DISEASE==0)/sum(DISEASE==0)))"
        ].join("\n")
      }

      // ADD MORE templates here by pasting more objects...
    ];

    function render(list) {
      var out = document.getElementById("results");
      var html = "";
      for (var i = 0; i < list.length; i++) {
        var t = list[i];
        html += "<div class='card'>";
        html += "<h3>" + escapeHtml(t.name) + "</h3>";
        if (t.tags && t.tags.length) {
          for (var k = 0; k < t.tags.length; k++) {
            html += "<span class='tag'>" + escapeHtml(t.tags[k]) + "</span>";
          }
        }
        html += "<div style='margin-top:10px;'>";
        html += "<button type='button' data-copy-id='" + escapeHtml(t.id) + "'>Copy</button>";
        html += "</div>";
        html += "<pre id='code_" + escapeHtml(t.id) + "'>" + escapeHtml(t.code) + "</pre>";
        html += "</div>";
      }
      out.innerHTML = html;

      var btns = document.querySelectorAll("button[data-copy-id]");
      for (var j = 0; j < btns.length; j++) {
        btns[j].onclick = function () {
          var id = this.getAttribute("data-copy-id");
          var pre = document.getElementById("code_" + id);
          copyText(pre ? pre.innerText : "");
        };
      }
    }

    function filter() {
      var q = (document.getElementById("q").value || "").toLowerCase();
      if (!q) { render(templates); return; }

      var res = [];
      for (var i = 0; i < templates.length; i++) {
        var t = templates[i];
        var hay = (t.name + " " + (t.tags ? t.tags.join(" ") : "")).toLowerCase();
        if (hay.indexOf(q) !== -1) res.push(t);
      }
      render(res);
    }

    document.getElementById("q").oninput = filter;

    // initial render
    render(templates);
  </script>
</body>
</html>

